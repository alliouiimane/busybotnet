## File: runit/runsv.c
- Type: C
- Entrée:
  - Paramètres de supervise (nom du service, fichiers supervise/*)
  - Signaux du système (arrêt/restart)
- Transformation / traitement:
  - Ouvre/écrit des fichiers de statut (supervise/pid.new, supervise/stat.new, supervise/status.new)
  - Utilise `vfork()` pour fork/respawn et `sprintf`/`strcpy` pour construire chaînes
  - Supprime (`unlink`) des fichiers temporaires et gère états de supervise
- Sortie:
  - Fichiers de supervision mis à jour (pid, status)
  - Lancement/respawn des services
- Points de risque:
  - **Opérations sur fichiers (open_trunc_or_warn, unlink)** : risque de TOCTOU (Time-of-check-to-time-of-use) si des chemins sont contrôlables par un attaquant — **MED/HIGH**
  - **Usage de `strcpy` / `sprintf`** sans checks de taille : risque de débordement de tampon (buffer overflow) — **HIGH**
  - **Usage de `vfork()`** : exécution de nouveaux processus — risque si arguments non validés — **HIGH**
  - **Manipulation des signaux** : mauvaise gestion peut conduire à fork zombies ou comportements non sécurisés — **MED**
- Recommandations:
  - Remplacer `strcpy`/`sprintf` par `strncpy`/`snprintf` et vérifier longueurs.
  - Vérifier et sécuriser les chemins de fichiers (échapper, canonicalize, vérifier owner/perms).
  - Utiliser primitives atomiques pour écriture d’état (tempfile + rename) plutôt que open_trunc/unlink brut.
  - Ajouter tests statiques (clang-tidy/cppcheck) ciblant buffer overflows et TOCTOU.
  - Ajouter alertes CI si usage de `vfork()` ou écriture de fichiers supervise modifiée.

---

## File: runit/chpst.c
- Type: C
- Entrée:
  - Options CLI et variables d'environnement (utilisées pour `chpst`, `setuidgid`, etc.)
- Transformation / traitement:
  - Fournit utilitaires pour changer UID/GID et exécuter processus sous d'autres comptes
  - Vérifie et applique limites systèmes (RLIMIT_*)
  - Log des erreurs via `bb_error_msg`
- Sortie:
  - Processus relancé sous un autre UID/GID
  - Codes de retour / logs
- Points de risque:
  - **Manipulation de privilèges (setuidgid, xsetuid/xsetgid)** : si mal contrôlé, peut permettre élévation de privilèges — **HIGH**
  - **Mauvaise validation des arguments** (chemins, comptes) — **MED/HIGH**
  - **Utilisation de limites RLIMIT** : si mal configuré, risque de DoS ou crash — **MED**
- Recommandations:
  - Restreindre invocation via ACL/RBAC.
  - Vérifier existence et propriété des comptes avant setuid/setgid.
  - Ajouter tests statiques / revue stricte pour code manipulant UID/GID.
  - Vérifier et valider toutes limites RLIMIT appliquées.
